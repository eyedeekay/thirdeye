<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Creating a simple static eepSite using Docker, Alpine, and i2pd | r-i2p-wiki</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Creating a simple static eepSite using Docker, Alpine, and i2pd" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The community wiki for /r/i2p" />
<meta property="og:description" content="The community wiki for /r/i2p" />
<link rel="canonical" href="https://eyedeekay.github.io/r-i2p-wiki/articles/i2p-docker-services/BasicStaticeepSite.html" />
<meta property="og:url" content="https://eyedeekay.github.io/r-i2p-wiki/articles/i2p-docker-services/BasicStaticeepSite.html" />
<meta property="og:site_name" content="r-i2p-wiki" />
<script type="application/ld+json">
{"description":"The community wiki for /r/i2p","@type":"WebPage","url":"https://eyedeekay.github.io/r-i2p-wiki/articles/i2p-docker-services/BasicStaticeepSite.html","headline":"Creating a simple static eepSite using Docker, Alpine, and i2pd","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/r-i2p-wiki/assets/css/style.css?v=e882a8239ba66e284ba822d8aa47586050006bc8">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="https://eyedeekay.github.io/r-i2p-wiki/">r-i2p-wiki</a></h1>
        
        

        <p>The community wiki for /r/i2p</p>

        
        <p class="view"><a href="https://github.com/eyedeekay/r-i2p-wiki">View the Project on GitHub <small>eyedeekay/r-i2p-wiki</small></a></p>
        

        

        
      </header>
      <section>

      <h1 id="creating-a-simple-static-eepsite-using-docker-alpine-and-i2pd">Creating a simple static eepSite using Docker, Alpine, and i2pd</h1>

<p>One of the most common things I hear people say about i2p is that they have
trouble finding interesting content on the existing eepSites. It’s true, to an
extent, as well. Most of the interesting eepSite content is, in fact, about i2p
and i2p-related projects. That’s not a bad thing, but it’s a little unfortunate
because it’s actually very easy to host your own content on the i2p network. In
this, the first of many guides to hosting web-like services within the i2p
network using i2pd and Docker.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The tutorial here assumes that you’ve already got a GNU/Linux machine with
Docker installed and have at least a passing familiarity with using Docker from
the terminal. If you need to install Docker, go <a href="https://docs.docker.com/install/linux/docker-ce/debian/">here for Debian-based Distros</a>,
<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">here for Ubuntu-based distros</a>,
and go <a href="https://docs.docker.com/install/linux/docker-ce/fedora/">here for Redhat based distros</a>.
On Alpine Linux, run “apk add docker” as root.</p>

<h3 id="create-a-docker-network-off-the-host">Create a Docker network off the host</h3>

<p>In order to provide static IP addresses for the containers you generate, you’ll
need to create a separate Docker network with an explicitly defined, limited
subnet.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    docker network create --subnet 172.81.81.0/29 eepsite
</code></pre></div></div>

<h3 id="configuring-an-i2p-router-with-a-single-http-service-tunnel">Configuring an i2p router with a single HTTP service tunnel</h3>

<p>There are a number of Docker containers that can be used to run i2pd, but for
the purposes of building services that run on i2pd, I like to make my own. I
prefer this approach because I like to use the defaults that are used by the
Debian package, and the easiest way to do that is to just use the Debian
package. The trade-off, of course, is a somewhat larger container.</p>

<h4 id="the-dockerfile">The Dockerfile</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    FROM debian:sid
    RUN apt-get update &amp;&amp; apt-get dist-upgrade -y
    RUN apt-get install -y gpg ca-certificates
    RUN echo "deb http://repo.lngserv.ru/debian stretch main" | tee /etc/apt/sources.list.d/i2pd.list
    RUN echo "deb-src http://repo.lngserv.ru/debian stretch main" | tee -a /etc/apt/sources.list.d/i2pd.list
    RUN apt-key adv --keyserver ha.pool.sks-keyservers.net --recv 66F6C87B98EBCFE2
    RUN apt-get update &amp;&amp; apt-get install -y i2pd
    COPY i2pd.conf tunnels.conf /etc/i2pd/
    CMD chown -R i2pd:i2pd /var/lib/i2pd; \
        ln -sf /usr/share/i2pd/certificates /var/lib/i2pd/certificates; \
        ln -sf /etc/i2pd/subscriptions.txt /var/lib/i2pd/subscriptions.txt; \
        su - -c "i2pd i2pd --service --loglevel=info \
            --conf=/etc/i2pd/i2pd.conf \
            --tunconf=/etc/i2pd/tunnels.conf \
            --log=/var/log/i2pd/log"; \
        sleep 5; \
        tail -f /var/log/i2pd/log
</code></pre></div></div>

<p>Before we build, we’ll need to create a configuration files to use for our
Dockerized i2pd container. In the i2pd.conf file, you should disable the HTTP
and SOCKS proxies and set the bandwidth to unlimited(“X” in the configuration
file). <a href="i2pd.conf">An example i2pd.conf can be found here</a>, it can be used for
<em>all</em> of the forthcoming eepSite tutorials I will be writing. The other,
slightly more interesting file is the tunnels.conf file.</p>

<h4 id="the-tunnelsconf-file">The tunnels.conf file</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [DARKHTTPD]
    type = http
    host = eepsite-darkhttpd
    port = 8080
    inbound.length = 3
    outbound.length = 3
    keys = darkhttpd.dat
</code></pre></div></div>

<p>Note that the inbound.length and outbound.length are both set to three. This is
optimized to make web sites anonymous, but it will cost some speed. Selecting
a different length may be an acceptable trade-off to achieve higher speed and
lower latency.</p>

<h4 id="build-and-run-the-container">Build and Run the container:</h4>

<p>Once you’ve got your configuration files and your Dockerfile created, run the
following command to build the container(Where Dockerfile.i2pd is the newly
created Dockerfile):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    docker build --rm -f Dockerfile.i2pd -t dockerhub_username/eepsite .
</code></pre></div></div>

<p>And this command to run the container:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    docker run --restart=always -i -t \
        --name eepsite-i2pd \
        --network eepsite \
        --network-alias eepsite-i2pd \
        --hostname eepsite-i2pd \
        --link eepsite-darkhttpd \
        --ip 172.81.81.2 \
        -p :4567 \
        -p 127.0.0.1:7070:7070 \
        -v eepsite:/var/lib/i2pd \
        dockerhub_username/eepsite-i2pd
</code></pre></div></div>

<h3 id="configuring-darkhttpd-with-your-content">Configuring DarkHTTPD with your content</h3>

<p>Now that your i2pd container is up and bootstrapping it’s connection to the i2p
network, you can start configuring your static eepSite container. To do this,
you’ll need a static web site to host. Either plain files or those generated by
a static site generator like Jekyll will do.</p>

<h4 id="the-dockerfile-1">The Dockerfile</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    FROM alpine:3.7
    ARG WEBSITE=website
    ENV WEBSITE=$WEBSITE
    RUN apk update
    RUN apk add darkhttpd
    COPY $WEBSITE /car/www/localhost/htdocs/$WEBSITE
    USER darkhttpd
    CMD darkhttpd /car/www/localhost/htdocs/$WEBSITE --port 8080 --log stdout --no-server-id
</code></pre></div></div>

<p>I keep my eepSite files in the same folder as the Dockefiles, under their own
directory named “website” to make things easier when passing the website’s files
into the Docker build context. As you can see, the path used can be changed by
passing an argument to the “docker build” command or the argument can be omitted
for a default value of “website.” The Dockerfile copies the contents of
“website” into a folder owned by darkhttpd, changes to the darkhttpd user, and
starts the server in the directory where we copied the files for our static
site.</p>

<h4 id="build-and-run-the-container-1">Build and Run the container:</h4>

<p>The full command to build the image for your static eepsite is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    docker build --rm \
        --build-arg WEBSITE=website \
        -f Dockerfile.darkhttpd -t dockerhub_username/eepsite-darkhttpd .
</code></pre></div></div>

<p>with the argument included. Make sure to change the argument if your website
is in a different directory than “website.”</p>

<p>Lastly, to run the container and serve the darkhttpd static website over i2p,
run the command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    docker run --restart=always -i -t -d \
        --name eepsite-darkhttpd \
        --network eepsite \
        --network-alias eepsite-darkhttpd \
        --hostname eepsite-darkhttpd \
        --ip 172.81.81.3 \
        dockerhub_username/eepsite-darkhttpd
</code></pre></div></div>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/eyedeekay">eyedeekay</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/r-i2p-wiki/assets/js/scale.fix.js"></script>
    
  </body>
</html>
